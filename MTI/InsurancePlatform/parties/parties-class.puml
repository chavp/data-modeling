@startuml

' ===== BASE ABSTRACT CLASSES =====
+abstract class DomainModel {
    {field} +Id: Guid? [Key] // รหัสประจำตัวเฉพาะของเอนทิตี้
    {field} +CreatedDateUtc: DateTime = DateTime.UtcNow // วันเวลาที่สร้างข้อมูล (UTC)
    {field} +CreatedBy: string 300 = Environment.MachineName // ผู้สร้างข้อมูล
    {field} +LastModifiedDateUtc: DateTime? // วันเวลาที่แก้ไขข้อมูลล่าสุด (UTC)
    {field} +LastModifiedBy: string? 300 // ผู้แก้ไขข้อมูลล่าสุด
    {field} +Revision: uint #set // เลขรุ่นของข้อมูล (สำหรับ Concurrency Control)
    --
    +Update(updateBy: string? = null): void // อัปเดตข้อมูลการแก้ไข
}

note left of DomainModel::Update
    LastModifiedBy = updateBy ?? Environment.MachineName 
    LastModifiedDateUtc = DateTime.UtcNow
    increment Revision + 1
end note

+abstract class EffectiveModel {
    {field} +EffectiveDate: DateOnly = DateOnly.FromDateTime(DateTime.Now) // วันที่เริ่มมีผล
    {field} +ExpiryDate: DateOnly = DateOnly.FromDateTime(DateTime.MaxValue) // วันที่หมดอายุ
    --
    +Expire(expiryDate: DateOnly? = null, updateBy: string? = null): void // ทำให้หมดอายุ
}

note right of EffectiveModel::Expire
    ExpiryDate = expiryDate ?? DateOnly.FromDateTime(DateTime.Today.AddDays(-1));
    Update(updateBy);
end note

+abstract class TypeModel {
    {field} +Code: string? 256 // รหัสประเภท (เช่น INSURED, OWNER)
    {field} +Name: string? 500 // ชื่อประเภท (เช่น ผู้เอาประกันภัย, เจ้าของ)
}

' ===== PARTY HIERARCHY =====
+abstract class Party <<Parties>> {
    {field} +PartyTitleId: Guid? // รหัสคำนำหน้าชื่อ
    {field} +PartyTitle: PartyTitle? // คำนำหน้าชื่อ (นาย, นาง, นางสาว, บริษัท)
    {field} +NationalityId: Guid? // รหัสสัญชาติ
    {field} +Nationality: Nationality? // สัญชาติ
    {field} +AssetRoles: List<AssetRole> = [] // บทบาทเกี่ยวกับทรัพย์สิน
    {field} +ContactMechanisms: List<ContactMechanism> = [] // ช่องทางการติดต่อ
    {field} +PartyContactMechanisms: List<PartyContactMechanism> = [] // ความสัมพันธ์กับช่องทางติดต่อ
}

+class PartyTitle <<PartyTitles>> {
    Index = Code *
    ..
    {field} +IsOrganization: bool // เป็นองค์กรหรือไม่ (true = องค์กร, false = บุคคล)
}

+class Nationality <<Nationalities>> {
    Index = Code *
}

+class Person <<People>> {
    Index = FirstName, LastName
    Index = CardId
    ..
    {field} +FirstName: string? 200 // ชื่อจริง
    {field} +MiddleName: string? 200 // ชื่อกลาง
    {field} +LastName: string? 300 // นามสกุล
    {field} +CardId: string? 50 // เลขบัตรประชาชน/หนังสือเดินทาง
    {field} +BirthDate: DateOnly? // วันเกิด
    {field} +Height: ushort? // ส่วนสูง (ซม.)
    {field} +Weight: ushort? // น้ำหนัก (กก.)
}

+abstract class Organization <<Organizations>> {
    Index = Name
    Index = Reference
    ..
    {field} +Name: string? 400 // ชื่อองค์กร/บริษัท
    {field} +Reference: string? 500 // เลขที่อ้างอิง/รหัสองค์กร
}

+class LegalOrganization <<LegalOrganizations>> {
    Index = FederalTaxIdNumber
    ..
    {field} +FederalTaxIdNumber: string? 50 * // เลขประจำตัวผู้เสียภาษี
}

+class InformalOrganization <<InformalOrganizations>> {
}

' ===== PARTY ROLE HIERARCHY =====
+abstract class PartyRole <<PartyRoles>> {
    Index = PartyId, PartyRoleTypeId *
    ..
    {field} +PartyId: Guid? * // รหัสของ Party (บุคคล/องค์กร)
    {field} +Party: Party? // ข้อมูล Party
    {field} +PartyRoleTypeId: Guid? * // รหัสประเภทบทบาท
    {field} +PartyRoleType: PartyRoleType? // ประเภทบทบาท (ผู้เอาประกันภัย, ผู้รับผลประโยชน์)
}

+class PartyRoleType <<PartyRoleTypes>> {
    Index = Code *
    ..
    {static} +Insured: string = "INSURED" // ผู้เอาประกันภัย
    {static} +Invoice: string = "INVOICE" // ผู้รับใบกำกับภาษี
}

+abstract class InsuredParty <<InsuredParties>> {
}

+class Insured <<Insureds>> {
}

+class Invoice <<Invoices>> {
}

' ===== ASSET HIERARCHY =====
+abstract class Asset <<Assets>> {
    Index = Name
    ..
    +Name: string? 300 * // ชื่อทรัพย์สิน
}

+class Vehicle <<Vehicles>> {
    {field} +Brand: string? 300 // ยี่ห้อรถ (โตโยต้า, ฮอนด้า, เบนซ์)
    {field} +Model: string? 600 // รุ่นรถ (วีออส, ซีวิค, C200)
    {field} +Color: string? 50 // สีรถ
    {field} +RegisterNo: string? 100 // ทะเบียนรถ
    {field} +RegisterProvince: string? 100 // จังหวัดที่จดทะเบียน
    {field} +RegisterYear: ushort? // ปีที่จดทะเบียน
    {field} +Chassis: string? 50 // เลขตัวถัง
    {field} +Cc: float? // ขนาดเครื่องยนต์ (ซีซี)
    {field} +Seat: float? // จำนวนที่นั่ง
    {field} +Weight: ushort? // น้ำหนักรถ (กก.)
    {field} +Tonnage: float? // น้ำหนักบรรทุก (ตัน)
    {field} +Engine: string? 100 // เลขเครื่องยนต์
    {field} +Passenger: ushort? // จำนวนผู้โดยสาร (คน)
}

+class AssetRole <<AssetRoles>> {
    {field} +PartyId: Guid? * // รหัสของ Party
    {field} +Party: Party? // ข้อมูล Party
    {field} +AssetRoleTypeId: Guid? * // รหัสประเภทบทบาทต่อทรัพย์สิน
    {field} +AssetRoleType: AssetRoleType? // ประเภทบทบาท (เจ้าของ, ผู้ใช้, ผู้เช่า)
    {field} +AssetId: Guid? * // รหัสทรัพย์สิน
    {field} +Asset: Asset? // ข้อมูลทรัพย์สิน
}

+class AssetRoleType <<AssetRoleTypes>> {
    Index = Code *
    ..
    {static} +Owner: string = "OWNER" // เจ้าของทรัพย์สิน
}

' ===== CONTACT MECHANISM HIERARCHY =====
+abstract class ContactMechanism <<ContactMechanisms>> {
    {field} +ContactMechanismTypeId: Guid? * // รหัสประเภทช่องทางติดต่อ
    {field} +ContactMechanismType: ContactMechanismType? // ประเภทช่องทางติดต่อ
    {field} +Parties: List<Party> = [] // รายการ Party ที่ใช้ช่องทางนี้
    {field} +PartyContactMechanisms: List<PartyContactMechanism> = [] // ความสัมพันธ์กับ Party
}

+class ContactMechanismType <<ContactMechanismTypes>> {
    Index = Code *
    ..
    {static} +Mobile: string = "MOBILE" // โทรศัพท์มือถือ
    {static} +HomePhone: string = "HOME_PHONE" // โทรศัพท์บ้าน
    {static} +OfficePhone: string = "OFFICE_PHONE" // โทรศัพท์ที่ทำงาน
    {static} +Email: string = "EMAIL" // อีเมล
    {static} +MainAddress: string = "MAIN_ADDRESS" // ที่อยู่หลัก
}

+class PostalAddress <<PostalAddresses>> {
    Index = Name *
    ..
    {field} +Name: string? 300 * // ชื่อที่อยู่ (บ้าน, ที่ทำงาน, ที่อยู่จัดส่ง)
    {field} +HouseNumber: string? 30 // เลขที่บ้าน
    {field} +VillageNumber: string? 30 // หมู่ที่
    {field} +Village: string? 200 // ชื่อหมู่บ้าน/ชุมชน
    {field} +Alley: string? 200 // ตรอก/ซอย
    {field} +Road: string? 200 // ถนน
    {field} +Building: string? 200 // ชื่ออาคาร/คอนโด
    {field} +Room: string? 30 // เลขที่ห้อง
    {field} +Floor: string? 30 // ชั้น
    {field} +Province: string? 200 // จังหวัด
    {field} +District: string? 200 // อำเภอ/เขต
    {field} +SubDistrict: string? 200 // ตำบล/แขวง
    {field} +ZipCode: string? 50 // รหัสไปรษณีย์
    {field} +DisplayName: string { get } "IgnoreDataMember" // ที่อยู่แบบเต็ม (สำหรับแสดงผล)
}

note right of PostalAddress::DisplayName
    Join of fields: 
    VillageNumber Village HouseNumber Alley Building 
    Floor Room SubDistrict District Province ZipCode
end note

+class Telecommunication <<Telecommunications>> {
    {field} +AreaCode: string? 5 // รหัสพื้นที่ (02, 031, 032)
    {field} +Number: string? 20 * // หมายเลขโทรศัพท์
    {field} +CountryCode: string? 10 // รหัสประเทศ (+66, +1, +86)
}

+class ElectronicAddress <<ElectronicAddresses>> {
    {field} +Address: string? 300 * // ที่อยู่อิเล็กทรอนิกส์ (อีเมล, เว็บไซต์, LINE ID)
}

+class PartyContactMechanism <<PartyContactMechanisms>> {
    {field} +PartyId: Guid? * // รหัส Party (บุคคล/องค์กร)
    {field} +Party: Party? // ข้อมูล Party
    {field} +ContactMechanismId: Guid? * // รหัสช่องทางติดต่อ
    {field} +ContactMechanism: ContactMechanism? // ข้อมูลช่องทางติดต่อ
}

' ===== INHERITANCE RELATIONSHIPS =====
' Base class inheritance
DomainModel <|-- EffectiveModel
DomainModel <|-- TypeModel
DomainModel <|-- Party
DomainModel <|-- Asset
DomainModel <|-- ContactMechanism

' Effective model inheritance
EffectiveModel <|-- PartyRole
EffectiveModel <|-- AssetRole
EffectiveModel <|-- PartyContactMechanism

' Type model inheritance
TypeModel <|-- PartyRoleType
TypeModel <|-- AssetRoleType
TypeModel <|-- ContactMechanismType
TypeModel <|-- PartyTitle
TypeModel <|-- Nationality

' Party hierarchy
Party <|-- Person
Party <|-- Organization
Organization <|-- LegalOrganization
Organization <|-- InformalOrganization

' Party role hierarchy
PartyRole <|-- InsuredParty
PartyRole <|-- Invoice
InsuredParty <|-- Insured

' Asset hierarchy
Asset <|-- Vehicle

' Contact mechanism hierarchy
ContactMechanism <|-- PostalAddress
ContactMechanism <|-- Telecommunication
ContactMechanism <|-- ElectronicAddress

' ===== ASSOCIATION RELATIONSHIPS =====
Party --> "0,1" PartyTitle
Party --> "0,1" Nationality
Party *-- AssetRole
Party *-- PartyContactMechanism
PartyRole --> "1" Party
PartyRole --> "1" PartyRoleType
AssetRole --> "1" Party
AssetRole --> "1" Asset
AssetRole --> "1" AssetRoleType
ContactMechanism --> "1" ContactMechanismType
ContactMechanism *-- PartyContactMechanism

@enduml